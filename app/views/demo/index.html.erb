<h1>PICSY</h1>

<table class="table table-bordered selectable">
  <tr>
    <th>アクター</th>
    <th>貢献度</th>
    <th>予算制約</th>
    <% @people.each.with_index do |person, i| %>
    <th id="to-p<%= i+1 %>">To P<%= i+1 %></th>
    <% end %>
  </tr>
  <% @matrix.each.with_index do |row, i| %>
  <tr>
    <th id="from-p<%= i+1 %>">P<%= i+1 %></th>
    <td><%= @contributions[i] %></td>
    <td id="self-p<%= i+1 %>"><%= @people[i].self_evaluation_quantized %></td>
    <% row.each.with_index do |col, j| %>
			<% if i == j %>
				<td>-</td>
			<% else %>
				<td class="evaluation" id="ev-p<%= i+1 %>-p<%= j+1 %>"><%= col %></td>
			<% end %>
    <% end %>
  </tr>
  <% end %>
</table>

<form class="well">

		<div class="control-group error" style="display:inline">
			<select id="person-from" class="input-medium">
				<% @people.each.with_index do |person, i| %>
				<option value="<%= i+1 %>">P<%= i+1 %></option>
				<% end %>
			</select>
			<span class="help-inline" style="margin-right:5px">から</span>
		</div>

		<div class="control-group success" style="display:inline">
			<select id="person-to" class="input-medium">
				<% @people.each.with_index do |person, i| %>
				<option value="<%= i+1 %>">P<%= i+1 %></option>
				<% end %>
			</select>
			<span class="help-inline" style="margin-right:5px">へ</span>
		</div>

	<div class="input-append" style="">
		<div class="control-group" style="display:inline">
			<span>
				<%= text_field_tag :amount, "", :class => "input-small", :style => "text-align:right" %>
			</span>
			<button type="submit" class="btn btn-primary">取引実行</button>
		</div>
	</div>

	<div class="input-append" style="display:block;margin:20px 0 0 0">
		<%= text_field_tag :natural_recovery, "100", :class => "input-xlarge", :style => "width:100px" %>
		<button type="submit" class="btn btn-primary">自然回収</button>
	</div>
</form>

<% if @trades.size > 0 %>
<h2>取引履歴</h2>
<table class="table table-striped table-bordered table-condensed">
  <tr>
    <th>#</th>
    <th>actors</th>
    <th>amount</th>
    <% @matrix[0].each.with_index do |col, i| %>
    <th>P<%= i+1 %></th>
    <% end %>
  </tr>
  <% @trades.each do |trade| %>
  <tr>
    <th>#<%= trade.id %></th>
    <td>P<%= trade.buyable_id %> &rarr; P<%= trade.sellable_id %></td>
    <td><%= sprintf("%0.04f", trade.amount) %></td>
    <% trade.propagations.each do |prop| %>
    <td><%= sprintf("%0.04f", prop.amount) %></td>
    <% end %>
  </tr>
  <% end %>
</table>
<% end %>
