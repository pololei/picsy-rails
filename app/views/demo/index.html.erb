<h1>PICSY</h1>

<table class="table table-bordered selectable">
  <tr>
    <th>アクター</th>
    <th>貢献度</th>
    <th>予算制約</th>
    <% @people.each.with_index do |person, i| %>
    <th id="to-p<%= person.id %>">To P<%= person.id %></th>
    <% end %>
  </tr>
  <% @matrix.each.with_index do |row, i| %>
  <tr>
    <th id="from-p<%= i+1 %>">P<%= @people[i].id %></th>
    <td><%= @contributions[i] %></td>
    <td id="self-p<%= i+1 %>"><%= @people[i].self_evaluation_quantized %></td>
    <% row.each.with_index do |col, j| %>
			<% if i == j %>
				<td>-</td>
			<% else %>
				<td class="evaluation" id="ev-p<%= @people[i].id %>-p<%= @people[j].id %>"><%= col %></td>
			<% end %>
    <% end %>
  </tr>
  <% end %>
</table>

<div class="well">
	<%= form_tag trade_path do %>
		<div class="control-group error" style="display:inline">
			<select name="person-from" id="person-from" class="input-medium">
				<option></option>
				<% @people.each.with_index do |person, i| %>
				<option value="<%= person.id %>">P<%= person.id %></option>
				<% end %>
			</select>
			<span class="help-inline" style="margin-right:5px">から</span>
		</div>

		<div class="control-group success" style="display:inline">
			<select name="person-to" id="person-to" class="input-medium">
				<option></option>
				<% @people.each.with_index do |person, i| %>
				<option value="<%= person.id %>">P<%= person.id %></option>
				<% end %>
			</select>
			<span class="help-inline" style="margin-right:5px">へ</span>
		</div>

		<div class="input-append" style="">
			<div class="control-group" style="display:inline">
				<span>
					<%= text_field_tag :amount, "", :class => "input-small", :style => "text-align:right",
						:type => "number", :min => "0", :max => "100000", :step => "1" %>
				</span>
				<button type="submit" class="btn btn-primary">取引実行</button>
			</div>
		</div>
	<% end %>

	<%= form_tag natural_recovery_path, :class => "input-append" do %>
		<%= text_field_tag :natural_recovery, "1", :class => "input-xlarge", :style => "width:100px",
			:type => "number", :min => "1", :max => "100", :step => "1" %>
		<span class="add-on">%</span>
		<button type="submit" class="btn btn-primary">自然回収</button>
	<% end %>
</div>

<% if @trades.size > 0 %>
<h2>取引履歴</h2>
<table class="table table-striped table-bordered table-condensed">
  <tr>
    <th>#</th>
    <th>アクター</th>
    <th>取引額</th>
    <% @matrix[0].each.with_index do |col, i| %>
    <th>P<%= i+1 %></th>
    <% end %>
  </tr>
  <% @trades.each do |trade| %>
  <tr>
    <th>#<%= trade.id %></th>
    <td>P<%= trade.buyable_id %> &rarr; P<%= trade.sellable_id %></td>
    <td><%= trade.amount_quantized %></td>
    <% trade.propagations.each do |prop| %>
    <td><%= prop.amount_quantized %></td>
    <% end %>
  </tr>
  <% end %>
</table>
<% end %>
